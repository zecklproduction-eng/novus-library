<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Reports | NOVUS Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/logo.png') }}">
    <style>
        body {
            background-color: #000000;
            color: white;
            font-family: 'Segoe UI', sans-serif;
        }
        .navbar {
            background-color: #1a1a1a;
            border-bottom: 1px solid #333;
        }
        .card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            color: white;
        }
        .table {
            color: white;
        }
        .table thead th {
            background-color: #2b2b2b;
            border-color: #444;
            color: #00d4ff;
        }
        .table tbody td {
            border-color: #444;
        }
        .badge-danger { background-color: #dc3545; }
        .badge-warning { background-color: #ffc107; color: black; }
        .badge-info { background-color: #00d4ff; color: black; }
        .btn-neon {
            background: #00d4ff;
            border: none;
            color: black;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 5px;
            transition: 0.3s;
        }
        .btn-neon:hover {
            background: white;
            box-shadow: 0 0 10px #00d4ff;
        }
        .report-reasons {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/admin/users">
                <img src="{{ url_for('static', filename='img/logo.png') }}" width="30" height="30" class="me-2">
                NOVUS Admin - User Reports
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/admin/users">User Management</a>
                <a class="nav-link" href="/admin/ai_summaries">AI Summaries</a>
                <a class="nav-link" href="/admin/system_logs">System Logs</a>
                <a class="nav-link active" href="/admin/reports">Reports</a>
                <a class="nav-link" href="/">Back to Site</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <!-- Users with 2+ Reports -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4 class="mb-0">Users with Multiple Reports (2+)</h4>
                        <small class="text-muted">These users require attention from administrators</small>
                    </div>
                    <div class="card-body">
                        {% if reported_users %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Report Count</th>
                                        <th>Reasons</th>
                                        <th>Latest Report</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for user in reported_users %}
                                    <tr>
                                        <td>{{ user[1] }}</td>
                                        <td>{{ user[2] or 'N/A' }}</td>
                                        <td>
                                            <span class="badge
                                                {% if user[3] == 'admin' %}badge-danger
                                                {% elif user[3] == 'publisher' %}badge-warning
                                                {% else %}badge-info{% endif %}">
                                                {{ user[3] }}
                                            </span>
                                        </td>
                                        <td><span class="badge badge-danger">{{ user[4] }}</span></td>
                                        <td>
                                            <span class="report-reasons" title="{{ user[5] }}">{{ user[5] }}</span>
                                        </td>
                                        <td>{{ user[6] }}</td>
                                        <td>
                                            <a href="/user/{{ user[0] }}" class="btn btn-sm btn-neon me-1">View Profile</a>
                                            <a href="/admin/users" class="btn btn-sm btn-outline-danger">Manage</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <p class="text-muted">No users currently have 2 or more reports.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- All Reports -->
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">All User Reports</h4>
                        <small class="text-muted">Complete history of user reports</small>
                    </div>
                    <div class="card-body">
                        {% if all_reports %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Reporter</th>
                                        <th>Reported User</th>
                                        <th>Reason</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for report in all_reports %}
                                    <tr>
                                        <td>{{ report[6] }}</td>
                                        <td>{{ report[2] }} (ID: {{ report[1] }})</td>
                                        <td>{{ report[4] }} (ID: {{ report[3] }})</td>
                                        <td>{{ report[5] }}</td>
                                        <td>
                                            <a href="/user/{{ report[1] }}" class="btn btn-sm btn-outline-primary me-1">View Reporter</a>
                                            <a href="/user/{{ report[3] }}" class="btn btn-sm btn-outline-warning">View Reported</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <p class="text-muted">No user reports found.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
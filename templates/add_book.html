{% extends "base.html" %}
{% block content %}
<div style="max-width: 1200px; margin: 30px auto; padding: 0 20px;">
  <h2 class="mb-4" style="color: var(--text-primary)">
    <i class="fas fa-cloud-upload-alt me-2" style="color: var(--neon-blue)"></i>
    Add New Content
  </h2>

  <!-- TYPE SELECTOR TABS -->
  <div style="display: flex; gap: 10px; border-bottom: 2px solid rgba(102, 126, 234, 0.2); margin-bottom: 30px;">
    <button class="type-tab active" onclick="switchTab('book')" style="background: none; border: none; color: #999; padding: 15px 20px; font-size: 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; border-bottom: 3px solid transparent; transition: all 0.3s; font-weight: 500;">
      <i class="fas fa-book"></i>
      <span>Book</span>
    </button>
    <button class="type-tab" onclick="switchTab('manga')" style="background: none; border: none; color: #999; padding: 15px 20px; font-size: 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; border-bottom: 3px solid transparent; transition: all 0.3s; font-weight: 500;">
      <i class="fas fa-images"></i>
      <span>Manga</span>
    </button>
  </div>

  <!-- ===== BOOK UPLOAD FORM ===== -->
  <div id="bookTab" class="tab-content" style="display: block;">
    <form method="POST" action="{{ url_for('add_book') }}" enctype="multipart/form-data" id="addBookForm" onsubmit="return simulatePublish(event)">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
        <!-- LEFT COLUMN -->
        <div style="grid-column: span 2;">
          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Book Details</h5>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Title</label>
              <input type="text" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(102, 126, 234, 0.2); color: #fff; border-radius: 6px; padding: 10px 12px; font-size: 14px; width: 100%; box-sizing: border-box;" name="title" required>
            </div>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Author</label>
              <input type="text" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(102, 126, 234, 0.2); color: #fff; border-radius: 6px; padding: 10px 12px; font-size: 14px; width: 100%; box-sizing: border-box;" name="author" required>
            </div>

            <label class="form-label mt-2" style="color: #ddd; font-weight:600;">Type</label>
            <select name="book_type" class="form-select" style="width:100%; margin-bottom: 16px; background: rgba(255,255,255,0.03); color:#fff; border:1px solid rgba(102,126,234,0.2); padding:10px 12px; border-radius:6px;" required>
              <option value="book">Book</option>
              <option value="manga">Manga</option>
            </select>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 12px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-bookmark" style="color: var(--neon-blue);"></i>
                Categories
              </label>
              <div id="bookCategoriesContainer" class="categories-checkbox-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px;">
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Action" onchange="updateBookCategoryCount()"> Action
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Adventure" onchange="updateBookCategoryCount()"> Adventure
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Children" onchange="updateBookCategoryCount()"> Children
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Comedy" onchange="updateBookCategoryCount()"> Comedy
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Drama" onchange="updateBookCategoryCount()"> Drama
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Fantasy" onchange="updateBookCategoryCount()"> Fantasy
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="General" onchange="updateBookCategoryCount()"> General
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Historical" onchange="updateBookCategoryCount()"> Historical
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Horror" onchange="updateBookCategoryCount()"> Horror
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Mystery" onchange="updateBookCategoryCount()"> Mystery
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Poetry" onchange="updateBookCategoryCount()"> Poetry
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Romance" onchange="updateBookCategoryCount()"> Romance
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Science Fiction" onchange="updateBookCategoryCount()"> Sci-Fi
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Supernatural" onchange="updateBookCategoryCount()"> Supernatural
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Thriller" onchange="updateBookCategoryCount()"> Thriller
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Young Adult" onchange="updateBookCategoryCount()"> YA
                </label>
              </div>
              <div id="bookCategoryCount" style="color: var(--neon-blue); font-size: 12px; margin-top: 10px; font-weight: 500; display: flex; align-items: center; gap: 6px;"><i class="fas fa-check-circle"></i><span>Select at least one category</span></div>
            </div>

            <!-- DESCRIPTION -->
            <div style="margin-bottom: 20px;">
              <h5 style="margin: 0 0 10px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Description</h5>
              <div class="description-editor-container">
                <div class="toolbar" id="editor-toolbar" style="margin-bottom:8px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                  <button type="button" class="btn btn-sm" style="display:inline-flex; align-items:center; justify-content:center; background:none; color:#ddd; border:none;" onclick="formatText('bold')"><i class="fas fa-bold"></i></button>
                  <button type="button" class="btn btn-sm" style="background:none; color:#ddd; border:none;" onclick="formatText('italic')"><i class="fas fa-italic"></i></button>
                  <button type="button" class="btn btn-sm" style="background:none; color:#ddd; border:none;" onclick="formatText('underline')"><i class="fas fa-underline"></i></button>
                  <span class="mx-2" style="color:#555">|</span>
                  <button type="button" class="btn btn-sm" style="background:none; color:#ddd; border:none;" onclick="formatText('insertUnorderedList')"><i class="fas fa-list-ul"></i></button>
                  <button type="button" class="btn btn-sm" style="background:none; color:#ddd; border:none;" onclick="formatText('insertOrderedList')"><i class="fas fa-list-ol"></i></button>
                </div>

                <!-- visible editor -->
                <div id="description"
     class="form-control description-area"
     contenteditable="true"
     data-placeholder="Type your book description here..."
     style="min-height:150px; padding:15px; background: rgba(255,255,255,0.03); border-radius:6px; border:1px solid rgba(102,126,234,0.12); color:#fff;"></div>

<textarea id="description_hidden" name="description" hidden></textarea>

              </div>
            </div>
          </div>

          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Book Files</h5>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">PDF File</label>
              <div style="border: 2px dashed rgba(102, 126, 234, 0.3); border-radius: 8px; padding: 30px 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(102, 126, 234, 0.05);" onclick="document.getElementById('bookPdf').click()">
                <input type="file" name="pdf_file" id="bookPdf" accept=".pdf" style="display:none">
                <i class="fas fa-file-pdf" style="color: var(--neon-blue); font-size: 30px;"></i>
                <p style="margin: 10px 0; color: #bbb;">Drag & Drop or Browse</p>
                <small style="color: #999;">PDF only (Max 50MB)</small>
                <div id="bookPdfName" style="display: none; color: #667eea; margin-top: 10px;"></div>
              </div>
            </div>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Audio File (Optional)</label>
              <div style="border: 2px dashed rgba(102, 126, 234, 0.3); border-radius: 8px; padding: 30px 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(102, 126, 234, 0.05);" onclick="document.getElementById('bookAudio').click()">
                <input type="file" name="audio_file" id="bookAudio" accept=".mp3" style="display:none">
                <i class="fas fa-headphones" style="color: var(--neon-blue); font-size: 30px;"></i>
                <p style="margin: 10px 0; color: #bbb;">Drag & Drop or Browse</p>
                <small style="color: #999;">MP3 only (Max 100MB)</small>
                <div id="bookAudioName" style="display: none; color: #667eea; margin-top: 10px;"></div>
              </div>
            </div>
          </div>

          <div class="d-grid mt-4">
            <button type="submit" id="publish-btn" class="btn btn-neon" style="font-size: 16px; padding: 12px;">
              <i class="fas fa-check me-2"></i>PUBLISH TO CATALOG
            </button>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div style="grid-column: span 1;">
          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Cover Image</h5>
            <div style="border: 2px dashed rgba(102, 126, 234, 0.3); border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(102, 126, 234, 0.05); display: flex; align-items: center; justify-content: center; height: 200px;" onclick="document.getElementById('bookCover').click()">
              <input type="file" name="cover_image" id="bookCover" accept="image/*" style="display:none" onchange="previewImage(this, 'coverImagePreview')">
              <div id="cover-upload-text-overlay">
                <i class="fas fa-cloud-upload-alt" style="color:var(--neon-blue); font-size: 40px;"></i>
                <p style="margin-bottom: 10px; color:var(--text-muted);">
                  Drag & Drop or <a href="#" onclick="event.preventDefault(); document.getElementById('bookCover').click();" style="color:var(--neon-blue)">Browse</a>
                </p>
                <small style="color: #999;">JPG, PNG (Max 5MB)</small>
              </div>
              <img id="coverImagePreview" src="#" alt="Cover Image Preview" style="display:none; max-width:100%; max-height:100%; object-fit:contain; border-radius:4px;">
              <button type="button" id="remove-coverImagePreview" class="btn btn-sm btn-outline-danger mt-2" style="display:none" onclick="removePreview('coverImagePreview', 'bookCover', 'cover-upload-text-overlay'); event.stopPropagation();">Remove</button>
            </div>
          </div>

          <!-- PUBLISHING STATUS -->
          <div class="section-container mb-4" id="publish-progress-card" style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding:20px;">
            <h5 class="section-title" style="font-size:14px; color:#fff; text-transform:uppercase;">PUBLISHING STATUS</h5>
            <div id="initial-status" class="text-center p-3">
              <i class="fas fa-circle-notch fs-3 text-warning mb-2"></i>
              <p class="small text-white fw-bold mb-1">Awaiting Publish Action</p>
              <span class="small text-muted">Click 'Publish' to start upload process.</span>
            </div>
            <div id="progress-area" style="display:none">
              <p id="progress-text" class="small fw-bold mb-1" style="color:var(--neon-blue)">Initializing...</p>
              <div class="progress mt-1" style="height:8px; background:#333">
                <div id="progressBarFill" class="progress-bar bg-info" role="progressbar" style="width:0%"></div>
              </div>
              <div class="d-flex justify-content-end small fw-bold mt-1">
                <span id="progress-percentage" style="color:var(--neon-blue)">0%</span>
              </div>
            </div>
          </div>

          <!-- CHECKLIST -->
          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Cataloging Checklist</h5>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" checked>
              <label class="form-check-label small">Metadata Verified</label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" checked>
              <label class="form-check-label small">Cataloging Checklist</label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox">
              <label class="form-check-label small">Cataloging process starts</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox">
              <label class="form-check-label small">Cataloging procedures</label>
            </div>
          </div>
        </div>
      </div>
      <input type="hidden" name="book_type" value="book">
    </form>
  </div>

  <!-- ===== MANGA UPLOAD FORM ===== -->
  <div id="mangaTab" class="tab-content" style="display: none;">
    <form method="POST" action="{{ url_for('add_book') }}" enctype="multipart/form-data" id="mangaForm">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
        <!-- LEFT COLUMN -->
        <div style="grid-column: span 2;">
          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Manga Details</h5>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Manga Title</label>
              <input type="text" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(102, 126, 234, 0.2); color: #fff; border-radius: 6px; padding: 10px 12px; font-size: 14px; width: 100%; box-sizing: border-box;" name="title" required>
            </div>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Author/Artist</label>
              <input type="text" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(102, 126, 234, 0.2); color: #fff; border-radius: 6px; padding: 10px 12px; font-size: 14px; width: 100%; box-sizing: border-box;" name="author" required>
            </div>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 12px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-bookmark" style="color: var(--neon-blue);"></i>
                Categories
              </label>
              <div id="mangaCategoriesContainer" class="categories-checkbox-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px;">
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Action" onchange="updateMangaCategoryCount()"> Action
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Adventure" onchange="updateMangaCategoryCount()"> Adventure
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Comedy" onchange="updateMangaCategoryCount()"> Comedy
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Drama" onchange="updateMangaCategoryCount()"> Drama
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Fantasy" onchange="updateMangaCategoryCount()"> Fantasy
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Historical" onchange="updateMangaCategoryCount()"> Historical
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Horror" onchange="updateMangaCategoryCount()"> Horror
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Romance" onchange="updateMangaCategoryCount()"> Romance
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Sci-Fi" onchange="updateMangaCategoryCount()"> Sci-Fi
                </label>
                <label class="category-checkbox" style="display: flex; align-items: center; padding: 10px 12px; background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">
                  <input type="checkbox" name="categories" value="Supernatural" onchange="updateMangaCategoryCount()"> Supernatural
                </label>
              </div>
              <div id="mangaCategoryCount" style="color: var(--neon-blue); font-size: 12px; margin-top: 10px; font-weight: 500; display: flex; align-items: center; gap: 6px;"><i class="fas fa-check-circle"></i><span>Select at least one category</span></div>
            </div>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-sync-alt" style="color: var(--neon-blue);"></i>
                Publishing Status
              </label>
              <select name="status" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.05) 100%); border: 2px solid rgba(102, 126, 234, 0.3); color: #fff; border-radius: 8px; padding: 10px 12px; font-size: 14px; width: 100%; box-sizing: border-box; cursor: pointer; transition: all 0.3s ease;" required>
                <option value="ongoing" style="background: #2a2a2a; color: #fff;">üîÑ Ongoing</option>
                <option value="completed" style="background: #2a2a2a; color: #fff;">‚úÖ Completed</option>
                <option value="hiatus" style="background: #2a2a2a; color: #fff;">‚è∏Ô∏è On Hiatus</option>
              </select>
            </div>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Description</label>
              <textarea style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(102, 126, 234, 0.2); color: #fff; border-radius: 6px; padding: 10px 12px; font-size: 14px; width: 100%; box-sizing: border-box;" name="description" rows="4" placeholder="Tell us about your manga..."></textarea>
            </div>
          </div>

          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">First Chapter</h5>
            <p style="color: #999; font-size: 13px; margin-bottom: 15px;">Upload the first chapter here. You can add more chapters later.</p>

            <div style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Upload Format</label>
              <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <label style="display: flex; align-items: center; cursor: pointer; color: #bbb;">
                  <input type="radio" name="chapter_format" value="images" checked onchange="toggleChapterFormat()" style="margin-right: 8px; cursor: pointer;">
                  <span>Images (Multiple Pages)</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer; color: #bbb;">
                  <input type="radio" name="chapter_format" value="pdf" onchange="toggleChapterFormat()" style="margin-right: 8px; cursor: pointer;">
                  <span>PDF File</span>
                </label>
              </div>
            </div>

            <!-- Images Upload Section -->
            <div id="imagesSection" style="margin-bottom: 20px;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Chapter 1 Pages</label>
              <p style="color: #999; font-size: 12px; margin-bottom: 12px;">Upload multiple page images (JPG, PNG). They will be automatically ordered by upload order.</p>
              <div style="border: 2px dashed rgba(102, 126, 234, 0.3); border-radius: 8px; padding: 30px 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(102, 126, 234, 0.05);" onclick="document.getElementById('chapterPages').click()">
                <input type="file" name="chapter_pages" id="chapterPages" accept="image/jpeg,image/png" multiple style="display:none">
                <i class="fas fa-images" style="color: var(--neon-blue); font-size: 30px;"></i>
                <p style="margin: 10px 0; color: #bbb;">Drag & Drop or Browse</p>
                <small style="color: #999;">Image files (JPG, PNG - Max 5MB each)</small>
                <div id="chapterPagesCount" style="display: none; color: #667eea; margin-top: 10px; font-weight: 600;"></div>
              </div>
              <div id="pagePreviewContainer" style="margin-top: 15px; max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 10px; display: none;">
                <p style="color: #aaa; font-size: 12px; margin: 0 0 10px 0;">Page Preview:</p>
                <div id="pagesList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px;"></div>
              </div>
            </div>

            <!-- PDF Upload Section -->
            <div id="pdfSection" style="margin-bottom: 20px; display: none;">
              <label style="margin-bottom: 8px; color: #ddd; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; display: block;">Chapter 1 PDF</label>
              <p style="color: #999; font-size: 12px; margin-bottom: 12px;">Upload a single PDF file for this chapter.</p>
              <div style="border: 2px dashed rgba(102, 126, 234, 0.3); border-radius: 8px; padding: 30px 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(102, 126, 234, 0.05);" onclick="document.getElementById('chapterPdf').click()">
                <input type="file" name="chapter_pdf" id="chapterPdf" accept="application/pdf" style="display:none">
                <i class="fas fa-file-pdf" style="color: var(--neon-blue); font-size: 30px;"></i>
                <p style="margin: 10px 0; color: #bbb;">Drag & Drop or Browse</p>
                <small style="color: #999;">PDF file (Max 50MB)</small>
                <div id="chapterPdfName" style="display: none; color: #667eea; margin-top: 10px; font-weight: 600;"></div>
              </div>
            </div>
          </div>

          <button type="submit" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: #fff; font-weight: 600; border-radius: 6px; transition: all 0.3s; cursor: pointer; width: 100%; font-size: 16px; padding: 12px;">
            <i class="fas fa-check me-2"></i>CREATE MANGA SERIES
          </button>
        </div>

        <!-- RIGHT COLUMN -->
        <div style="grid-column: span 1;">
          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Cover Image</h5>
            <div style="border: 2px dashed rgba(102, 126, 234, 0.3); border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(102, 126, 234, 0.05); display: flex; align-items: center; justify-content: center; height: 240px;" onclick="document.getElementById('mangaCover').click()">
              <input type="file" name="cover_image" id="mangaCover" accept="image/*" style="display:none" onchange="previewImage(this, 'mangaCoverPreview')">
              <div id="mangaCoverPreview">
                <i class="fas fa-cloud-upload-alt" style="color:var(--neon-blue); font-size: 40px;"></i>
                <p style="margin-bottom: 10px; color:var(--text-muted);">
                  Drag & Drop or <a href="#" onclick="event.preventDefault(); document.getElementById('mangaCover').click();" style="color:var(--neon-blue)">Browse</a>
                </p>
                <small style="color: #999;">JPG, PNG (Max 5MB)</small>
              </div>
            </div>
          </div>

          <div style="background: rgba(102, 126, 234, 0.08); border: 1px solid rgba(102, 126, 234, 0.2); border-radius: 8px; padding: 20px;">
            <h5 style="margin: 0 0 20px 0; font-size: 14px; font-weight: 600; color: #fff; text-transform: uppercase; letter-spacing: 0.5px;">Info</h5>
            <p style="font-size: 12px; color: #999; line-height: 1.6;">
              After creating your manga series, you can upload additional chapters anytime from your dashboard.
            </p>
          </div>
        </div>
      </div>
      <input type="hidden" name="book_type" value="manga">
    </form>
  </div>
</div>

<style>
.type-tab:hover {
  color: #667eea;
}

.type-tab.active {
  color: #667eea !important;
  border-bottom-color: #667eea !important;
}

.tab-content {
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

select option {
  background: #1a1a2e;
  color: #fff;
}

button[type="submit"]:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

@media (max-width: 768px) {
  [style*="grid-column: span 2"] {
    grid-column: span 1 !important;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Update category count for book
  window.updateBookCategoryCount = function() {
    const countDiv = document.getElementById('bookCategoryCount');
    const checkboxes = document.querySelectorAll('#bookCategoriesContainer input[type="checkbox"]:checked');
    if (checkboxes.length === 0) {
      countDiv.innerHTML = '<i class="fas fa-check-circle"></i><span>Select at least one category</span>';
      countDiv.style.color = '#999';
    } else if (checkboxes.length === 1) {
      const selectedText = checkboxes[0].parentElement.textContent.trim();
      countDiv.innerHTML = `<i class="fas fa-check-circle"></i><span>‚úì ${selectedText}</span>`;
      countDiv.style.color = 'var(--neon-blue)';
    } else {
      countDiv.innerHTML = `<i class="fas fa-check-circle"></i><span>‚úì ${checkboxes.length} categories selected</span>`;
      countDiv.style.color = 'var(--neon-blue)';
    }
  };

  // Update category count for manga
  window.updateMangaCategoryCount = function() {
    const countDiv = document.getElementById('mangaCategoryCount');
    const checkboxes = document.querySelectorAll('#mangaCategoriesContainer input[type="checkbox"]:checked');
    if (checkboxes.length === 0) {
      countDiv.innerHTML = '<i class="fas fa-check-circle"></i><span>Select at least one category</span>';
      countDiv.style.color = '#999';
    } else if (checkboxes.length === 1) {
      const selectedText = checkboxes[0].parentElement.textContent.trim();
      countDiv.innerHTML = `<i class="fas fa-check-circle"></i><span>‚úì ${selectedText}</span>`;
      countDiv.style.color = 'var(--neon-blue)';
    } else {
      countDiv.innerHTML = `<i class="fas fa-check-circle"></i><span>‚úì ${checkboxes.length} categories selected</span>`;
      countDiv.style.color = 'var(--neon-blue)';
    }
  };

  function switchTab(tab) {
    const bookTab = document.getElementById('bookTab');
    const mangaTab = document.getElementById('mangaTab');
    const tabs = document.querySelectorAll('.type-tab');
    
    if (tab === 'book') {
      bookTab.style.display = 'block';
      mangaTab.style.display = 'none';
      tabs[0].classList.add('active');
      tabs[1].classList.remove('active');
    } else {
      bookTab.style.display = 'none';
      mangaTab.style.display = 'block';
      tabs[1].classList.add('active');
      tabs[0].classList.remove('active');
    }
  }

  window.switchTab = switchTab;

  function formatText(cmd) {
    document.getElementById('description').focus();
    try {
      document.execCommand(cmd, false, null);
    } catch (e) {
      console.warn('Formatting command failed', cmd, e);
    }
  }

  function previewImage(input, previewId) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById(previewId);
        if (!preview) return;
        // If target is an <img>, set src and show it
        if (preview.tagName.toLowerCase() === 'img') {
          preview.src = e.target.result;
          preview.style.display = 'block';
          // hide overlay text if present
          const overlay = document.getElementById('cover-upload-text-overlay');
          if (overlay) overlay.style.display = 'none';
          const removeBtn = document.getElementById('remove-coverImagePreview');
          if (removeBtn) removeBtn.style.display = 'inline-block';
        } else {
          preview.innerHTML = '<img src="' + e.target.result + '" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">';
        }
      };
      reader.readAsDataURL(input.files[0]);
    }
  }

  function removePreview(imgId, inputId, overlayId) {
    const img = document.getElementById(imgId);
    const input = document.getElementById(inputId);
    const overlay = document.getElementById(overlayId);
    if (img && img.tagName.toLowerCase() === 'img') {
      img.src = '#';
      img.style.display = 'none';
    }
    if (input) {
      input.value = null;
    }
    if (overlay) {
      overlay.style.display = 'block';
    }
    const removeBtn = document.getElementById('remove-coverImagePreview');
    if (removeBtn) removeBtn.style.display = 'none';
  }

  function simulatePublish(e) {
    e.preventDefault();
    const form = document.getElementById('addBookForm');
    const desc = document.getElementById('description');
    const descHidden = document.getElementById('description_hidden');
    const initial = document.getElementById('initial-status');
    const progressArea = document.getElementById('progress-area');
    const progressBar = document.getElementById('progressBarFill');
    const progressText = document.getElementById('progress-text');
    const progressPercent = document.getElementById('progress-percentage');

    if (desc && descHidden) {
      descHidden.value = desc.innerHTML.trim();
    }

    if (initial) initial.style.display = 'none';
    if (progressArea) progressArea.style.display = 'block';

    let val = 0;
    progressText.textContent = 'Uploading...';

    const interval = setInterval(function() {
      val += Math.floor(Math.random() * 15) + 5; // bump progress
      if (val > 100) val = 100;
      if (progressBar) progressBar.style.width = val + '%';
      if (progressPercent) progressPercent.textContent = val + '%';

      if (val >= 100) {
        clearInterval(interval);
        progressText.textContent = 'Finalizing...';
        setTimeout(function() {
          // submit the form for real
          form.submit();
        }, 600);
      }
    }, 300);

    return false; // prevent default immediate submit
  }

  window.formatText = formatText;
  window.previewImage = previewImage;
  window.removePreview = removePreview;
  window.simulatePublish = simulatePublish;

  // File name display handlers (guard existence)
  const bookPdf = document.getElementById('bookPdf');
  if (bookPdf) bookPdf.addEventListener('change', function() {
    const name = document.getElementById('bookPdfName');
    if (!name) return;
    name.textContent = '‚úì ' + (this.files[0]?.name || '');
    name.style.display = this.files[0] ? 'block' : 'none';
  });

  const bookAudio = document.getElementById('bookAudio');
  if (bookAudio) bookAudio.addEventListener('change', function() {
    const name = document.getElementById('bookAudioName');
    if (!name) return;
    name.textContent = '‚úì ' + (this.files[0]?.name || '');
    name.style.display = this.files[0] ? 'block' : 'none';
  });

  const chapter1 = document.getElementById('chapter1');
  if (chapter1) chapter1.addEventListener('change', function() {
    const name = document.getElementById('chapter1Name');
    if (!name) return;
    name.textContent = '‚úì ' + (this.files[0]?.name || '');
    name.style.display = this.files[0] ? 'block' : 'none';
  });

  // Handle multiple chapter page uploads
  const chapterPages = document.getElementById('chapterPages');
  if (chapterPages) {
    chapterPages.addEventListener('change', function() {
      const files = this.files;
      const countDiv = document.getElementById('chapterPagesCount');
      const previewDiv = document.getElementById('pagePreviewContainer');
      const pagesList = document.getElementById('pagesList');
      
      if (files.length > 0) {
        countDiv.textContent = `‚úì ${files.length} page${files.length !== 1 ? 's' : ''} selected`;
        countDiv.style.display = 'block';
        previewDiv.style.display = 'block';
        pagesList.innerHTML = '';
        
        // Show preview of each page
        Array.from(files).forEach((file, index) => {
          const reader = new FileReader();
          reader.onload = function(e) {
            const thumbContainer = document.createElement('div');
            thumbContainer.style.cssText = 'position: relative; cursor: pointer; border-radius: 4px; overflow: hidden;';
            thumbContainer.innerHTML = `
              <img src="${e.target.result}" style="width: 100%; height: 100px; object-fit: cover; border: 1px solid rgba(102,126,234,0.3); border-radius: 4px;">
              <span style="position: absolute; top: 2px; right: 2px; background: var(--neon-blue); color: #000; font-size: 10px; font-weight: 600; padding: 2px 6px; border-radius: 3px;">${index + 1}</span>
            `;
            pagesList.appendChild(thumbContainer);
          };
          reader.readAsDataURL(file);
        });
      } else {
        countDiv.style.display = 'none';
        previewDiv.style.display = 'none';
      }
    });
  }

  // Handle PDF file selection
  const chapterPdf = document.getElementById('chapterPdf');
  if (chapterPdf) {
    chapterPdf.addEventListener('change', function() {
      const nameDiv = document.getElementById('chapterPdfName');
      if (nameDiv) {
        nameDiv.textContent = this.files[0] ? `‚úì ${this.files[0].name}` : '';
        nameDiv.style.display = this.files[0] ? 'block' : 'none';
      }
    });
  }

  // Toggle between images and PDF format
  window.toggleChapterFormat = function() {
    const format = document.querySelector('input[name="chapter_format"]:checked').value;
    const imagesSection = document.getElementById('imagesSection');
    const pdfSection = document.getElementById('pdfSection');
    
    if (format === 'images') {
      imagesSection.style.display = 'block';
      pdfSection.style.display = 'none';
    } else {
      imagesSection.style.display = 'none';
      pdfSection.style.display = 'block';
    }
  };
});
</script>
{% endblock %}

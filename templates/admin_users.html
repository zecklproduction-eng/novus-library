{% extends "base.html" %}
{% block title %}User Management | NOVUS{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
  <h2 class="mb-3" style="color: var(--text-primary);">User Management</h2>
  <p class="text-muted mb-4">
    Ban / unban or delete accounts. Banned users cannot log in.
  </p>

  <div class="section-container">
    <div class="table-responsive">
      <table class="table table-dark table-striped align-middle mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Role</th>
             <th>Avatar</th>
            <th>Status</th>
            <th style="width: 260px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u[0] }}</td>
            <td>{{ u[1] }}</td>
            <td>
              <span class="badge bg-secondary text-uppercase">{{ u[2] }}</span>
            </td>
             <td>
               {% if u[5] %}
                 <img src="{{ u[5] }}" alt="{{ u[1] }}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
               {% else %}
                 <span class="text-muted">â€”</span>
               {% endif %}
             </td>
            <td>
              {% if u[3] == 'banned' %}
              <span class="badge bg-danger">Banned</span>
              {% else %}
              <span class="badge bg-success">Active</span>
              {% endif %}
            </td>
            <td>
              <div class="d-flex gap-2">
                {% if u[3] != 'banned' %}
                <form method="post" action="{{ url_for('user_ban', user_id=u[0]) }}">
                  <button class="btn btn-sm btn-outline-warning"
                          onclick="return confirm('Ban this user?')">
                    Ban
                  </button>
                </form>
                {% else %}
                <form method="post" action="{{ url_for('user_unban', user_id=u[0]) }}">
                  <button class="btn btn-sm btn-outline-success">
                    Unban
                  </button>
                </form>
                {% endif %}

                {% if u[2] != 'admin' %}
                <form method="post" action="{{ url_for('user_delete', user_id=u[0]) }}">
                  <button class="btn btn-sm btn-outline-danger"
                          onclick="return confirm('Delete this user permanently?')">
                    Delete
                  </button>
                </form>
                {% endif %}
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted py-3">
              No users found.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
